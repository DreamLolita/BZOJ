用$f[i][j][x][y]$表示到第$i$个人，总共$j$个男生，以$i$结尾的任意长度中男生最多比女生多$x$，女生最多比男生多$y$的方案数，然后dp即可。