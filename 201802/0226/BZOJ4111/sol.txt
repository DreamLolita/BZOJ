由于每个点至多连4条边，所以令$f_{i,j,k}$表示到$(i,j)$这个位置，已经打了$k$个字符所需的最少步数，直接bfs就行了。