爆搜字符串$S$的最小表示，然后通过$KMP$求出权值，再用组合数计算方案数即可。 