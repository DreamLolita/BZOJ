
https://www.zybuluo.com/y20070316/note/730248

对于每个$k$，问题等价于求有多少置换满足：
1.存在一个循环长度为$k$
2.任意一个循环的长度\req 2

我们枚举这种环的个数
设$f_t$为至少有$kt$个人分成$t$个长度为$k$的循环的方案数。
考虑枚举第一个人和哪些人分在了一起，同时有$(k-1)!$种可能的环。
那么我们有：
$$
f_t={kt-1}\choose {k-1} f{i-1}(k-1)!
$$
设$d_i$表示$i$个人错位排列的方案数，那么至少有$t$个长度为$k$的循环的方案数为：
$$
n\choose {kt} f_td_{n-kt}
$$
考虑用容斥原理解决问题，那么这一部分对答案的贡献就是：
$$
(-1)^{t-1} n\choose {kt} f_td_{n-kt}
$$
总时间复杂度$O(nlogn)$