考虑用f[i][j]表示在i节点的子树中，最大值<=j，最多能选择多少点。如何转移呢？父亲节点的f数组可以看成儿子节点的f数组对应位置相加。然后再用 当前点权值-1处的f值 +1 来更新当前点权值后面的所有f值。

为此，我们可以考虑用线段树+标记永久化维护，我们要实现维护区间最大值。然后转移的时候可以直接用线段树合并搞定。细节还是比较多的。