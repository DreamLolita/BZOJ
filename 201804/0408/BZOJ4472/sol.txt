很裸的树形dp吧，限制每个点的经过次数就是限制从子树中取值。
至于多种方案随便记一下就可以了。