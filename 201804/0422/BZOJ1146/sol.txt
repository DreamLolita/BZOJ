树剖+线段树套平衡树
这个就很直接了- -，三个log。

主席树+树状数组
节点x修改，询问一段路径l->r
节点x修改只对子树中与外界交流有影响，而子树在dfs序中是一段区间[L[x],R[x]]，对这一段用差分的修改方法就行了
lca用树剖求的，就是两个log。