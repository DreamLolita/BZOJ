这题的建图十分巧妙。

我们只需要把黑色棋子移动到目标位置即可，那么考虑一条合法的移动路径，开始和结尾的点只交换了一次,中间的点交换了两次.
所以我们可以把每个点拆成三个点(a,b,c).
如果这个点是原图中的黑点.
$a$向$b$连流量为$\frac {c[i][j]} 2$,费用为0的边.
$b$向$c$连流量为$\frac {(c[i][j]+1)} 2$,费用为0的边.
$S$向$b$连流量为1,费用为0的边.

如果这个点是新图中的黑点.
$a$向$b$连流量为$\frac {(c[i][j]+1)} 2$,费用为0的边.
$b$向$c$连流量为$\frac {c[i][j]} 2$,费用为0的边.
$b$向$T$连流量为1,费用为0的边.

如果这个点在新图和原图中都是白点.
$a$向$b$连流量为$\frac c[i][j] 2$,费用为0的边.
$b$向$c$连流量为$\frac c[i][j] 2$,费用为0的边.
对于相邻的两个点$(x,y)$
$x.c$向$y.a$连流量为$inf$,费用为1的边.
跑最小费用最大流即可.