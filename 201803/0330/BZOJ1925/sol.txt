首先这看起来很像个dp，然后我还只想到最后一位是上升或者下降状态什么的。
正解的dp方程很玄学，我们令$f[i][j]$表示前$i$个数，最后一个数是$j$且现在是上升状态的方案数。
那么对于$f[i][j-1]$中的每种合法情况，交换$j和j-1$的位置，仍然合法。
接下来我们要知道除去$j$后$i-1$的排列且最后为下降状态的方案数，设其为$g$，显然$g[i][j]=f[i][i-j+1]$
因此$f[i][j]=f[i][j-1]+g[i-1][j-1]=f[i][j]+f[i-1][i-1-(j-1)+1]=f[i][j]+f[i-1][i-j+1]$