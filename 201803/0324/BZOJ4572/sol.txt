这道题根本不会- -，只会最暴力的状压，我们求的就是$3^(n*m)-$不合法。
然后实际上要用到轮廓线dp，我是看着std打的qwq。
设$f[i][j][S][x][y]$表示填到了$(i,j)$，轮廓线上每个位置作为末尾是否完全匹配第一个串的状态为$S$，与第一个串$kmp$到了$x$，与第二个串$kmp$到了$y$的方案数。