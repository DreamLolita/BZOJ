分情况讨论一下：
1.$b$比$a$高明且$a$和$b$谈笑风生，那么$c$只需在$a$的子树中取就好了,此时贡献为$siz[p]*min(dep[p-1],k)$
2.$a$比$b$高明且$a$和$b$谈笑风生，$c$在$b$的子树上，考虑到子树问题，想到dfs序，那么问题变为求子树$a$区间中深度在$dep[p]+1~dep[p]+k$中所有点$siz$的和 ，可以用主席树完成，以$dep$为下标建树。